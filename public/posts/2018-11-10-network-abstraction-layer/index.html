<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="en">
<meta name=color-scheme content="light dark">
<meta name=author content="Yusuke Ohashi">
<meta name=description content="I am experimenting a new way for network request in Kiri library. Kiri is Moya inspired abstract networking layer. I was very impressed by Moya architecture, so to learn from it the most, I decided to trace the same architecture by writing by myself, instead of copy and paste. :D
We need to break down client library into three parts.
Request    Normally, you have to construct networking request every time.">
<meta name=keywords content="blog,developer,personal">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://cdn.yusuke.cloud/assets/image/golden-gate-bridge.jpg">
<meta name=twitter:title content="Network Abstraction Layer">
<meta name=twitter:description content="I am experimenting a new way for network request in Kiri library. Kiri is Moya inspired abstract networking layer. I was very impressed by Moya architecture, so to learn from it the most, I decided to trace the same architecture by writing by myself, instead of copy and paste. :D
We need to break down client library into three parts.
Request    Normally, you have to construct networking request every time.">
<meta property="og:title" content="Network Abstraction Layer">
<meta property="og:description" content="I am experimenting a new way for network request in Kiri library. Kiri is Moya inspired abstract networking layer. I was very impressed by Moya architecture, so to learn from it the most, I decided to trace the same architecture by writing by myself, instead of copy and paste. :D
We need to break down client library into three parts.
Request    Normally, you have to construct networking request every time.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://yusuke.cloud/posts/2018-11-10-network-abstraction-layer/"><meta property="og:image" content="https://cdn.yusuke.cloud/assets/image/golden-gate-bridge.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-11-10T00:00:00+00:00">
<meta property="article:modified_time" content="2018-11-10T00:00:00+00:00">
<title>
Network Abstraction Layer Â· Yusuke Ohashi
</title>
<link rel=canonical href=https://yusuke.cloud/posts/2018-11-10-network-abstraction-layer/>
<link rel=preload href="https://yusuke.cloud/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=https://yusuke.cloud/css/coder.min.34dfa7b2f5cdeb0f5302b2628f4a7a4bfe88a2431e1397ee4ec605c56ab69701.css integrity="sha256-NN+nsvXN6w9TArJij0p6S/6IokMeE5fuTsYFxWq2lwE=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=https://yusuke.cloud/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=https://yusuke.cloud/css/gistfix.css>
<link rel=icon type=image/png href=https://yusuke.cloud/img/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=https://yusuke.cloud/img/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=https://yusuke.cloud/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=https://yusuke.cloud/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.86.1">
</head>
<body class="preload-transitions colorscheme-auto">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=https://yusuke.cloud/>
Yusuke Ohashi
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=https://yusuke.cloud/>Home</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=https://yusuke.cloud/about/>About</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=https://yusuke.cloud/posts/>Posts</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=https://yusuke.cloud/index.xml>RSS</a>
</li>
<li class="navigation-item menu-separator">
<span>|</span>
</li>
<li class=navigation-item>
<a href=https://yusuke.cloud/ja/>ðŸ‡¯ðŸ‡µ</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://yusuke.cloud/posts/2018-11-10-network-abstraction-layer/>
Network Abstraction Layer
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2018-11-10T00:00:00Z>
November 10, 2018
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read
</span>
</div>
<div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=https://yusuke.cloud/categories/ios/>iOS</a></div>
</div>
</header>
<div>
<p>I am experimenting a new way for network request in <code>Kiri</code> library.
<code>Kiri</code> is <code>Moya</code> inspired abstract networking layer. I was very impressed by <code>Moya</code> architecture, so to learn from it the most, I decided to trace the same architecture by writing by myself, instead of copy and paste. :D</p>
<p>We need to break down client library into three parts.</p>
<h2 id=request>
Request
<a class=heading-link href=#request>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>Normally, you have to construct networking request every time.
Instead, in Kiri, your network configuration is compiled in one place, like class, enum.
And the class, enum must conform to <code>RequestContainer</code> protocol.</p>
<p>Sample code looks like this.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>TestAPIRequest</span> {
  <span style=color:#66d9ef>case</span> getitems
  <span style=color:#66d9ef>case</span> postitem
  <span style=color:#66d9ef>case</span> updateitem
  <span style=color:#66d9ef>case</span> deleteitem
}

<span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>TestAPIRequest</span>: RequestContainer {
  <span style=color:#66d9ef>var</span> baseURL: URL {
    <span style=color:#66d9ef>return</span> URL(string: <span style=color:#e6db74>&#34;https://www.example.com/api/v1&#34;</span>)<span style=color:#f92672>!</span>
  }
  
  <span style=color:#66d9ef>var</span> path: String {
    <span style=color:#66d9ef>switch</span> <span style=color:#66d9ef>self</span> {
      <span style=color:#66d9ef>case</span> .getitems:
      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;/getitems&#34;</span>
      .....
    }
  }
  
  ....
}
</code></pre></div><p>It is better in terms of designing an API Client.
Before you start to create client module, you can take a glance at whole structure.
And you don&rsquo;t need to pass constant strings to every class, well while you wrap such things by extracting methods, since Kiri can have common parts like <code>baseURL</code>, so that you can avoid duplicate code in your app.</p>
<p>But if your api has different endpoints per API, or stuff like that, things are not that easy. In such case you might want to create seprate classses per API. It also makes sense. If you encounter such API (unfortunately), you had better take a look at APIKit instead. It&rsquo;s supposed to have separate classses per API, and for response, it&rsquo;s more generic approach than Kiri or Moya.</p>
<h2 id=networking>
Networking
<a class=heading-link href=#networking>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>iOS has their own networking class, URLSession. But it makes no sense to wrap URLSession now. <strong>We have <code>Alamofire</code>.</strong>
Alamofire automatically validates request and response, and also returns JSON. However, I prefer keeping response <code>Data</code>, since network library should support multiple response formats.</p>
<p>Kiri makes use of Alamofire for network request, and delegate building a request to it.</p>
<p>In the most cases, Alamofire works very well, but in case you need more premitive networking to build parameters by yourself, and so on, it might not be good for you.</p>
<h2 id=response>
Response
<a class=heading-link href=#response>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>I found there is a trade off. If you make response generic, your request will be fragmented to separate classes. On the other hand, if you make request generic, your response will be fragmented.</p>
<p>I read code of both <code>Moya</code> and <code>APIKit</code>. In my opinion, these are the most sophisticated architecture in swift networking, whereas they have pros and cons.</p>
<p>I don&rsquo;t find the best solution for networking yet, but for now, choosing wisely according to your app requirements would be the best answer.</p>
<h2 id=references>
References
<a class=heading-link href=#references>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<ul>
<li><a href=https://github.com/junkpiano/Kiri>junkpiano/Kiri</a></li>
<li><a href=https://github.com/Moya/Moya>Moya/Moya</a></li>
<li><a href=https://github.com/ishkawa/APIKit>ishkawa/APIKit</a></li>
</ul>
<p><em><code>Kiri</code> is the way smaller than Moya, but it is working fine in my personal project. Why not you try it!?</em></p>
</div>
<footer>
<script src=https://utteranc.es/client.js repo=junkpiano/yusuke.cloud issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</footer>
</article>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}}</script>
</section>
</div>
<footer class=footer>
<section class=container>
<p>Welcome to my personal website!</p>
Â©
2021
Yusuke Ohashi
</section>
</footer>
</main>
<script src=https://yusuke.cloud/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js integrity="sha256-A7F3afT5GuNWZ+HyocqMFvUFYlds+Q/zKzF5kmkU2qU="></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-38557572-5','auto'),ga('send','pageview'))</script>
</body>
</html>