<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Munin Installation Memo | Yusuke Ohashi</title>
<meta name=keywords content>
<meta name=description content="Have you ever listened to Munin? Munin is a server resource monitoring tool, which provides graphical interfaces for a bunch of data
Munin is quite simple and easy to set up.
Here, I will write down my configuration when I set up munin lately. I suppose that you are using Ubuntu 18.04 LTS.
$ sudo apt update $ sudo apt install munin munin-node nginx Nginx Configuration server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; # Add index.">
<meta name=author content="Yusuke Ohashi">
<link rel=canonical href=https://yusuke.cloud/posts/munin-installation-memo/>
<link crossorigin=anonymous href=https://yusuke.cloud/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=https://yusuke.cloud/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://yusuke.cloud/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://yusuke.cloud/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://yusuke.cloud/favicon-32x32.png>
<link rel=apple-touch-icon href=https://yusuke.cloud/apple-touch-icon.png>
<link rel=mask-icon href=https://yusuke.cloud/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.90.0-DEV">
<link rel=alternate hreflang=en href=https://yusuke.cloud/posts/munin-installation-memo/>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-38557572-5','auto'),ga('send','pageview'))</script><meta property="og:title" content="Munin Installation Memo">
<meta property="og:description" content="Have you ever listened to Munin? Munin is a server resource monitoring tool, which provides graphical interfaces for a bunch of data
Munin is quite simple and easy to set up.
Here, I will write down my configuration when I set up munin lately. I suppose that you are using Ubuntu 18.04 LTS.
$ sudo apt update $ sudo apt install munin munin-node nginx Nginx Configuration server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; # Add index.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://yusuke.cloud/posts/munin-installation-memo/"><meta property="og:image" content="https://cdn.yusuke.cloud/assets/image/golden-gate-bridge.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-04-21T16:02:57+09:00">
<meta property="article:modified_time" content="2020-04-21T16:02:57+09:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://cdn.yusuke.cloud/assets/image/golden-gate-bridge.jpg">
<meta name=twitter:title content="Munin Installation Memo">
<meta name=twitter:description content="Have you ever listened to Munin? Munin is a server resource monitoring tool, which provides graphical interfaces for a bunch of data
Munin is quite simple and easy to set up.
Here, I will write down my configuration when I set up munin lately. I suppose that you are using Ubuntu 18.04 LTS.
$ sudo apt update $ sudo apt install munin munin-node nginx Nginx Configuration server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; # Add index.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://yusuke.cloud/posts/"},{"@type":"ListItem","position":3,"name":"Munin Installation Memo","item":"https://yusuke.cloud/posts/munin-installation-memo/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Munin Installation Memo","name":"Munin Installation Memo","description":"Have you ever listened to Munin? Munin is a server resource monitoring tool, which provides graphical interfaces for a bunch of data\nMunin is quite simple and easy to set up.\nHere, I will write down my configuration when I set up munin lately. I suppose that you are using Ubuntu 18.04 LTS.\n$ sudo apt update $ sudo apt install munin munin-node nginx Nginx Configuration server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; # Add index.","keywords":[],"articleBody":"Have you ever listened to Munin? Munin is a server resource monitoring tool, which provides graphical interfaces for a bunch of data\nMunin is quite simple and easy to set up.\nHere, I will write down my configuration when I set up munin lately. I suppose that you are using Ubuntu 18.04 LTS.\n$ sudo apt update $ sudo apt install munin munin-node nginx Nginx Configuration server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; # Add index.php to the list if you are using PHP index index.html index.htm index.nginx-debian.html; server_name _; location /munin { alias /var/www/html/munin; } location ^~ /munin-cgi/munin-cgi-graph/ { access_log off; fastcgi_split_path_info ^(/munin-cgi/munin-cgi-graph)(.*); fastcgi_param PATH_INFO $fastcgi_path_info; fastcgi_pass unix:/var/run/munin/fastcgi-graph.sock; include fastcgi_params; } } Restart nginx.\n$ sudo service nginx restart Munin Configuration munin.conf\ndbdir /var/lib/munin htmldir /var/www/html/munin logdir /var/log/munin rundir /var/run/munin [servername1.domain] address 127.0.0.1 use_node_name yes [servername2.domain] address [ip address] use_node_name yes Run munin as FCGI $ sudo chown -R munin:www-data /var/run/munin $ sudo spawn-fcgi -s /var/run/munin/fastcgi-html.sock -U www-data -u www-data -g www-data /usr/lib/munin/cgi/munin-cgi-html $ sudo spawn-fcgi -s /var/run/munin/fastcgi-graph.sock -U www-data -u www-data -g www-data /usr/lib/munin/cgi/munin-cgi-graph This is the most complicated part.\nBy default /var/run/munin is owned by munin. However, in runtime, nginx user(www-data) will access this socket. /var/run/munin must be accessible for both munin and www-data.\nFirst of all, you must change owner of this directory. The owner of /var/run/munin is munin, and users belonging to www-data can also read and write data there. munin runs cron jobs to refresh backend data, and I observed it checks this directory on each cron job. The socket file is read-only, but other files might be overwritten by munin cron. Thatâ€™s why I made munin as owner user.\nNext, FCGI process must be owned by www-data(nginx user). On the contrary to Apache, Nginx cannot run CGI directly, instead, it loads CGI daemon. In terms of server load average, FCGI is more efficient than CGI, while it keeps running on memory. To run CGI, whenever user access to web server, web server launches application process. It is quite heavy and inefficient for web server resources.\nCurrently, no web application frameworks adopt CGI.\nRestart Munin $ sudo service munin-node restart Install Munin nodes On all nodes,\n$ sudo apt update $ sudo apt install munin-node munin-node.conf Add this line.\nallow ^12\\.34\\.56\\.78$ # master server ip address Restart a node.\n$ sudo service munin-node restart Monitor on the browser Congratulations. You are all set. Now is the time to go to http://{your address}/munin. You will see beautiful graphs. All data are refreshed every 5 mins.\nHave a nice monitoring life!\n","wordCount":"428","inLanguage":"en","datePublished":"2020-04-21T16:02:57+09:00","dateModified":"2020-04-21T16:02:57+09:00","author":{"@type":"Person","name":"Yusuke Ohashi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yusuke.cloud/posts/munin-installation-memo/"},"publisher":{"@type":"Organization","name":"Yusuke Ohashi","logo":{"@type":"ImageObject","url":"https://yusuke.cloud/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://yusuke.cloud accesskey=h title="Yusuke Ohashi (Alt + H)">Yusuke Ohashi</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<ul class=lang-switch><li>|</li>
<li>
<a href=https://yusuke.cloud/ja/ title=ðŸ‡¯ðŸ‡µ aria-label=:jp:>ðŸ‡¯ðŸ‡µ</a>
</li>
</ul>
</span>
</div>
<ul id=menu>
<li>
<a href=https://yusuke.cloud/ title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://yusuke.cloud/about/ title=About>
<span>About</span>
</a>
</li>
<li>
<a href=https://yusuke.cloud/posts/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://yusuke.cloud/index.xml title=RSS>
<span>RSS</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Munin Installation Memo
</h1>
<div class=post-meta><span title="2020-04-21 16:02:57 +0900 JST">April 21, 2020</span>&nbsp;Â·&nbsp;Yusuke Ohashi
</div>
</header>
<div class=post-content><p>Have you ever listened to <a href=http://munin-monitoring.org/>Munin</a>?
Munin is a server resource monitoring tool, which provides graphical interfaces for a bunch of data</p>
<p>Munin is quite simple and easy to set up.</p>
<p>Here, I will write down my configuration when I set up munin lately.
I suppose that you are using <a href=https://releases.ubuntu.com/18.04.4/>Ubuntu 18.04 LTS</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo apt update
$ sudo apt install munin munin-node nginx
</code></pre></div><h3 id=nginx-configuration>Nginx Configuration<a hidden class=anchor aria-hidden=true href=#nginx-configuration>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location /munin {
            alias /var/www/html/munin;
        }

        location ^~ /munin-cgi/munin-cgi-graph/ {
            access_log off;
            fastcgi_split_path_info ^(/munin-cgi/munin-cgi-graph)(.*);
            fastcgi_param PATH_INFO $fastcgi_path_info;
            fastcgi_pass unix:/var/run/munin/fastcgi-graph.sock;
            include fastcgi_params;
        }

}
</code></pre></div><p>Restart nginx.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo service nginx restart
</code></pre></div><h2 id=munin-configuration>Munin Configuration<a hidden class=anchor aria-hidden=true href=#munin-configuration>#</a></h2>
<p>munin.conf</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>dbdir   /var/lib/munin
htmldir /var/www/html/munin
logdir /var/log/munin
rundir  /var/run/munin

[servername1.domain]
    address 127.0.0.1
    use_node_name yes

[servername2.domain]
    address [ip address]
    use_node_name yes
</code></pre></div><h2 id=run-munin-as-fcgi>Run munin as FCGI<a hidden class=anchor aria-hidden=true href=#run-munin-as-fcgi>#</a></h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo chown -R munin:www-data /var/run/munin
$ sudo spawn-fcgi -s /var/run/munin/fastcgi-html.sock -U www-data -u www-data -g www-data /usr/lib/munin/cgi/munin-cgi-html
$ sudo spawn-fcgi -s /var/run/munin/fastcgi-graph.sock -U www-data -u www-data -g www-data /usr/lib/munin/cgi/munin-cgi-graph
</code></pre></div><p>This is the most complicated part.</p>
<p>By default <code>/var/run/munin</code> is owned by munin. However, in runtime, nginx user(www-data) will access this socket.
<code>/var/run/munin</code> must be accessible for both munin and www-data.</p>
<p>First of all, you must change owner of this directory.
The owner of /var/run/munin is munin, and users belonging to www-data can also read and write data there.
munin runs cron jobs to refresh backend data, and I observed it checks this directory on each cron job.
The socket file is read-only, but other files might be overwritten by munin cron. That&rsquo;s why I made munin as owner user.</p>
<p>Next, FCGI process must be owned by www-data(nginx user). On the contrary to Apache, Nginx cannot run CGI directly, instead, it loads CGI daemon.
In terms of server load average, FCGI is more efficient than CGI, while it keeps running on memory. To run CGI, whenever user access to web server, web server launches application process. It is quite heavy and inefficient for web server resources.</p>
<p>Currently, no web application frameworks adopt CGI.</p>
<h2 id=restart-munin>Restart Munin<a hidden class=anchor aria-hidden=true href=#restart-munin>#</a></h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo service munin-node restart
</code></pre></div><h2 id=install-munin-nodes>Install Munin nodes<a hidden class=anchor aria-hidden=true href=#install-munin-nodes>#</a></h2>
<p>On all nodes,</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo apt update
$ sudo apt install munin-node
</code></pre></div><h3 id=munin-nodeconf>munin-node.conf<a hidden class=anchor aria-hidden=true href=#munin-nodeconf>#</a></h3>
<p>Add this line.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>allow ^12\.34\.56\.78$ # master server ip address
</code></pre></div><p>Restart a node.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo service munin-node restart
</code></pre></div><h2 id=monitor-on-the-browser>Monitor on the browser<a hidden class=anchor aria-hidden=true href=#monitor-on-the-browser>#</a></h2>
<p>Congratulations. You are all set. Now is the time to go to http://{your address}/munin.
You will see beautiful graphs. All data are refreshed every 5 mins.</p>
<p>Have a nice monitoring life!</p>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://yusuke.cloud>Yusuke Ohashi</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>